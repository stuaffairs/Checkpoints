<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container py-4">
  <h2 class="mb-4">Checkpoints</h2>
  <p>คะแนนเก็บ วิชาสังคมศึกษา รหัสวิชา ส32101</p>

  <!-- ฟอร์มค้นหา -->
  <form id="searchForm" class="row g-3 mb-4">
    <div class="col-auto">
      <input type="text" id="studentId" class="form-control" placeholder="กรอกเลขประจำตัวนักเรียน">
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">ค้นหา</button>
    </div>
  </form>

  <!-- ตารางผลลัพธ์ -->
  <table id="resultTable" class="table table-bordered table-striped d-none">
    <thead>
      <tr>
        <th>ห้อง</th>
        <th>เลขที่</th>
        <th>เลขประจำตัว</th>
        <th>ชื่อ-สกุล</th>
        <th>สมุด</th>
        <th>ส1</th>
        <th>ต้มยำ</th>
        <th>รวม1</th>
        <th>ช10</th>
        <th>ผล5</th>
        <th>ประยุกต์</th>
        <th>รวม2</th>
        <th>รวม3</th>
        <th>ส20</th>
        <th>ซ่อม</th>
        <th>รวม4</th>
        <th>ชุมชน</th>
        <th>RCEP</th>
        <th>รวม5</th>
        <th>Test</th>
        <th>ใบงาน</th>
        <th>รวม6</th>
        <th>รวม7</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    // เมื่อกดค้นหา
    document.getElementById("searchForm").addEventListener("submit", function(e){
      e.preventDefault();
      const studentId = document.getElementById("studentId").value.trim();
      if (!studentId) return;
      google.script.run.withSuccessHandler(showResults).searchStudent(studentId);
    });

    // แสดงผลข้อมูลในตาราง
    function showResults(data) {
      const table = document.getElementById("resultTable");
      const tbody = table.querySelector("tbody");
      tbody.innerHTML = "";

      if (data.length === 0) {
        tbody.innerHTML = `<tr><td colspan="23" class="text-center text-danger">ไม่พบข้อมูล</td></tr>`;
      } else {
        data.forEach(row => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${row["ห้อง"] || ""}</td>
            <td>${row["เลขที่"] || ""}</td>
            <td>${row["เลขประจำตัว"] || ""}</td>
            <td>${row["ชื่อ-สกุล"] || ""}</td>
            <td>${row["สมุด"] || ""}</td>
            <td>${row["ส1"] || ""}</td>
            <td>${row["ต้มยำ"] || ""}</td>
            <td>${row["รวม1"] || ""}</td>
            <td>${row["ช10"] || ""}</td>
            <td>${row["ผล5"] || ""}</td>
            <td>${row["ประยุกต์"] || ""}</td>
            <td>${row["รวม2"] || ""}</td>
            <td>${row["รวม3"] || ""}</td>
            <td>${row["ส20"] || ""}</td>
            <td>${row["ซ่อม"] || ""}</td>
            <td>${row["รวม4"] || ""}</td>
            <td>${row["ชุมชน"] || ""}</td>
            <td>${row["RCEP"] || ""}</td>
            <td>${row["รวม5"] || ""}</td>
            <td>${row["Test"] || ""}</td>
            <td>${row["ใบงาน"] || ""}</td>
            <td>${row["รวม6"] || ""}</td>
            <td>${row["รวม7"] || ""}</td>
          `;
          tbody.appendChild(tr);
        });
      }
      table.classList.remove("d-none");
    }
  </script>
</body>
</html>
